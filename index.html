<!DOCTYPE html>
<html lang="it-IT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Boolzapp</title>

    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

     <!-- foglio stile css -->
     <link rel="stylesheet" href="css/style.css">

     <!-- browser icon -->
    <link rel="icon" href="img/3670051.png">
</head>
<body>

    <!--script VueJs-->
    <script src="https://unpkg.com/vue@3"></script> 

    <!-- libreria Luxon -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>

    <div id="app">
        
        <!-- container verde in alto -->
        <div id="container-green"></div>
        <!-- container grigio di sfondo -->
        <div id="container-big-grey"></div>
        <!-- inizio container principale di utenti e chat -->
        <div id="container-big-chat" class="d-flex">
            <!-- inizio container con profilo proprio e chat -->
            <div id="container-contacts">
                <!-- inizio sezione profilo proprio -->
                <div id="user-profile" class="d-flex justify-content-between">
                    <div class="d-flex align-items-center">
                        <img class="rounded-5 ms-2" src="img/my-avatar.jpg" alt="">
                        <h4 class="fs-6 ms-2">Miky</h4>
                    </div>
                    <div class="d-flex align-items-center gap-3 fs-5 me-4">
                        <a href=""><i class="fa-solid fa-circle-notch"></i></a>
                        <a href=""><i class="fa-solid fa-message"></i></a>
                        <a href=""><i class="fa-solid fa-ellipsis-vertical"></i></a>
                    </div>
                </div>
                <!-- fine sezione profilo proprio -->
                <!-- inizio sezione notifiche nuovi messaggi -->
                <div id="notifications" class="d-flex align-items-center">
                    <a href=""><i class="fa-solid fa-bell-slash fs-3 rounded-5 ms-4 me-4"></i></a>
                    <div>
                        <h3>Ricevi notifiche di nuovi messaggi</h3>
                        <h4><a href="">Attiva notifiche desktop</a></h4>
                    </div>
                </div>
                <!-- fine sezione notifiche nuovi messaggi -->
                <!-- inizio sezione ricerca chat -->
                <div id="search-chat" class="p-2">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                        <div class="form-floating">
                            <input v-model="keyFiltered" type="search" class="form-control" placeholder="Cerca o inizia una nuova chat">
                            <label for="floatingInputGroup1">Cerca o inizia una nuova chat</label>
                        </div>
                    </div>
                </div>
                <!-- fine sezione ricerca chat -->
                <!-- inizio sezione con tutti gli utenti della chat -->
                <div id="user-chat-list" class="mt-4">
                    <div id="user" 
                         v-for="(contact, index) in searchChat()" 
                         class="d-flex justify-content-between"
                         @click="clickSingleChat(index)"
                         :class="index == activeContact ? 'active' : ''"
                    >
                        <div class="d-flex gap-3 align-items-center ms-4">
                            <img class="rounded-5 mt-2" :src="contact.avatar" :alt="`avatar-user-${contact.name}`">
                            <div id="user-text" class="flex-column">
                                <h2 class="fs-5">{{ contact.name }}</h2>
                                <h3 class="fs-6">Ultimo messaggio inviato</h3>
                            </div>
                        </div>
                        <div class="d-flex align-items-end me-2">
                            <h4 class="fs-6">{{ formatLastMessageDateTime(contact.messages[contact.messages.length - 1].date) }}
                        </div>    
                    </div>
                </div>
                <!-- fine sezione con tutti gli utenti della chat -->
            </div>
            <!-- fine container con profilo proprio e chat -->
            <!-- inizio container principale della chat -->
            <div id="container-chat" class="d-flex flex-column justify-content-between">
                <!-- inizio sezione che identifica le diverse chat -->
                <div id="user-chat" v-if="activeContact !== null">
                    <div id="user-profile-chat" class="border border-start d-flex justify-content-between">
                        <div v-if="activeContact !== null" class="d-flex align-items-center">
                            <img class="rounded-5 ms-2" :src="contacts[activeContact].avatar" :alt="`avatar-user-${contacts[activeContact].name}`">
                            <div id="user-text" class="flex-column">
                                <h2 class="fs-6">{{ contacts[activeContact].name }}</h2>
                                <h6 class="fs-6">{{ getLastMessageDateTime(contacts[activeContact].messages) }}</h6>
                            </div>
                        </div>
                        <div id="icons-chat" class="d-flex align-items-center gap-3 fs-5 me-4">
                            <a href=""><i class="fa-solid fa-magnifying-glass"></i></a>
                            <a href=""><i class="fa-solid fa-paperclip"></i></a>
                            <!-- inizio dropdown menu -->
                            <div class="dropdown">
                                <button class="btn" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa-solid fa-ellipsis-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                    <li><a class="dropdown-item" href="#" @click.prevent="deleteChat">Elimina chat</a></li>
                                </ul>
                            </div>
                            <!-- fine dropdown menu -->
                        </div>
                    </div>
                </div>
                <!-- fine sezione che identifica le diverse chat -->
                <!-- inizio sezione con il corpo principale della chat -->
                <div id="main-chat">
                    <div v-if="activeContact !== null">
                        <div v-for="(message, messageIndex) in contacts[activeContact].messages" :key="messageIndex">
                            <div v-if="message.status === 'sent'" class="d-flex flex-column align-items-end">
                                <div id="user-message" class="d-flex align-items-center justify-content-between ps-3 rounded-3 mb-3">
                                    <div>
                                        <h2 class="p-3">{{ message.message }}</h2>
                                    </div>
                                    <div class="d-flex flex-column align-items-end">
                                        <div class="dropdown">
                                            <button class="btn" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fa-solid fa-angle-down"></i>
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <li><a class="dropdown-item" href="#" @click="deleteMessage(messageIndex)">Cancella messaggio</a></li>
                                                <li><a class="dropdown-item" href="">Informazioni messaggio</a></li>
                                            </ul>
                                        </div>
                                        <div class="pe-1 fs-6 text-nowrap">
                                            <span>{{ formatMessageDate(message.date) }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div v-else-if="message.status === 'received'" class="d-flex flex-column align-items-start">
                                <div id="reply-message" class="d-flex align-items-center justify-content-between ps-3 rounded-3 mb-3">
                                    <div>
                                        <h2 class="p-3">{{ message.message }}</h2>
                                    </div>
                                    <div class="mt-5 pe-1 fs-6 text-nowrap">
                                        <span>{{ formatMessageDate(message.date) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else>
                        <div class="d-flex flex-column align-items-center">
                            <p id="no-contact" class="fs-3">Nessun contatto attivo</p>
                            <p id="encrypted" class="d-flex align-items-center gap-3"><i class="fa-solid fa-lock"></i>I tuoi messaggi personali sono protetti dalla crittografia end-to-end</p>
                        </div>
                    </div>
                </div>
                <!-- fine sezione con il corpo principale della chat -->
                <!-- inizio sezione di scrittura in chat -->
                <div id="input-chat" v-if="activeContact !== null" class="d-flex justify-content-between align-items-center">
                    <a href=""><i class="fa-regular fa-face-smile ms-5 fs-3 text-black"></i></a>
                    <div class="form-floating flex-grow-1 mx-5">
                        <input type="text" 
                               class="form-control" 
                               id="messageInput" 
                               placeholder="Scrivi un messaggio" 
                               @keypress.enter="sendMessage"
                        >
                        <label for="messageInput">Scrivi un messaggio</label>
                    </div>
                    <a href=""><i class="fa-solid fa-microphone me-5 fs-3 text-black"></i></a>
                </div>
                <!-- fine sezione di scrittura in chat -->
            </div>
            <!-- fine container principale della chat -->
        </div>
        <!-- fine container principale di utenti e chat -->
    </div>     

    <!-- script bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- foglio script js -->
    <script type="text/javascript" src="js/script.js"></script>

</body>
</html>